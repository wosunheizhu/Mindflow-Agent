å¤ªå¥½äº†ï¼æˆ‘ç»™ä½ ä¸€ä»½**å¯ç›´æ¥ç²˜è´´åˆ° Cursor** çš„æ”¹é€ è„šæœ¬ï¼ŒæŠŠå‰ç«¯â€œæ·±åº¦æ€è€ƒâ€æŒ‰é’®åšæˆ**çœŸå®å¯æ§**ï¼ˆå¼€/å…³ + æ€è€ƒé‡ ä½/ä¸­/é«˜ï¼‰ï¼Œå¹¶æŠŠè®¾ç½®**éšè¯·æ±‚ä¼ ç»™åç«¯**ï¼ˆå…¼å®¹ä½ ç°æœ‰ `deepThinking` å­—æ®µï¼ŒåŒæ—¶æ–°å¢æ ‡å‡† `reasoning.effort`ï¼‰ã€‚åŒæ—¶ä¹ŸæŠŠæ•°å­—å‘˜å·¥ï¼ˆ`AvatarDisplay`ï¼‰è¿™ä¸€è·¯æ‰“é€šã€‚

---

## âœ… ç›®æ ‡

* å·¥å…·æ é‡Œçš„â€œæ·±åº¦æ€è€ƒâ€æŒ‰é’® â†’ çœŸæ­£æ§åˆ¶

  * å¼€å…³ï¼šON/OFF
  * æ€è€ƒé‡ï¼šLow / Medium / Highï¼ˆå¯ç‚¹æŒ‰é’®å³ä¾§å°èœå•åˆ‡æ¢ï¼‰
* è¯·æ±‚ä½“å¸¦ä¸Šï¼š

  * `deepThinkingEnabled` å¸ƒå°”ï¼ˆå‘åå…¼å®¹ï¼‰
  * `deepThinkingLevel` æšä¸¾ï¼š`low|medium|high`
  * `reasoning: { effort: 'low'|'medium'|'high' }`ï¼ˆæ ‡å‡†å­—æ®µï¼Œä¾› GPT-5 ä½¿ç”¨ï¼‰
* æ•°å­—å‘˜å·¥ç«¯ï¼ˆ`AvatarDisplay.tsx`ï¼‰ä¹Ÿä¼šå‘é€åŒæ ·çš„ `deep_thinking_enabled`ã€`deep_thinking_level`ã€`reasoning`ã€‚

---

## ğŸ› ï¸ Cursor Promptï¼ˆç›´æ¥ç²˜è´´æ‰§è¡Œï¼‰

```bash
# ========== 1) ä¸»èŠå¤©é¡µï¼šapp/chat/page.tsx ==========
OPEN app/chat/page.tsx

# 1.1 æ–°å¢ï¼šæ·±åº¦æ€è€ƒè®¾ç½®ï¼ˆå¼€å…³ + ç­‰çº§ï¼‰ï¼Œå¹¶ä¸ localStorage åŒæ­¥
CODEMOD app/chat/page.tsx <<'PATCH'
*** Begin Patch
*** Update File: app/chat/page.tsx
@@
-  const [deepThinking, setDeepThinking] = useState(false);
+  // æ·±åº¦æ€è€ƒè®¾ç½®ï¼šå¼€å…³ + ç­‰çº§ï¼ˆlow/medium/highï¼‰
+  const [deepThinkingEnabled, setDeepThinkingEnabled] = useState<boolean>(() => {
+    if (typeof window === 'undefined') return false;
+    const saved = localStorage.getItem('deep_thinking_enabled');
+    return saved ? saved === 'true' : false;
+  });
+  const [deepThinkingLevel, setDeepThinkingLevel] = useState<'low'|'medium'|'high'>(() => {
+    if (typeof window === 'undefined') return 'low';
+    return (localStorage.getItem('deep_thinking_level') as any) || 'low';
+  });
+  useEffect(() => {
+    if (typeof window !== 'undefined') {
+      localStorage.setItem('deep_thinking_enabled', String(deepThinkingEnabled));
+      localStorage.setItem('deep_thinking_level', deepThinkingLevel);
+    }
+  }, [deepThinkingEnabled, deepThinkingLevel]);
@@
-  const [browserSearch, setBrowserSearch] = useState(false);
+  const [browserSearch, setBrowserSearch] = useState(false);
*** End Patch
PATCH

# 1.2 å·¥å…·æ  UIï¼šæŒ‰é’®æ§åˆ¶å¼€å…³ + ä¸‹æ‹‰é€‰æ‹©æ€è€ƒç­‰çº§
CODEMOD app/chat/page.tsx <<'PATCH'
*** Begin Patch
*** Update File: app/chat/page.tsx
@@
-          <button
-            onClick={() => setDeepThinking(!deepThinking)}
-            className={`btn-ghost text-sm ${deepThinking ? 'bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400' : ''}`}
-            title="æ·±åº¦æ€è€ƒæ¨¡å¼ï¼ˆä½¿ç”¨æ›´å¼ºå¤§çš„æ¨ç†èƒ½åŠ›ï¼‰"
-          >
-            <Brain size={16} className={deepThinking ? 'text-purple-600' : ''} />
-            æ·±åº¦æ€è€ƒ
-            {deepThinking && (
-              <span className="ml-1 text-xs px-1.5 py-0.5 rounded bg-purple-200 dark:bg-purple-800 text-purple-800 dark:text-purple-200">
-                ON
-              </span>
-            )}
-          </button>
+          <div className="relative flex items-center gap-2">
+            <button
+              onClick={() => setDeepThinkingEnabled(!deepThinkingEnabled)}
+              className={`btn-ghost text-sm ${
+                deepThinkingEnabled ? 'bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400' : ''
+              }`}
+              title="æ·±åº¦æ€è€ƒæ¨¡å¼ï¼ˆä½¿ç”¨æ›´å¼ºå¤§çš„æ¨ç†èƒ½åŠ›ï¼‰"
+            >
+              <Brain size={16} className={deepThinkingEnabled ? 'text-purple-600' : ''} />
+              æ·±åº¦æ€è€ƒ
+              {deepThinkingEnabled && (
+                <span className="ml-1 text-xs px-1.5 py-0.5 rounded bg-purple-200 dark:bg-purple-800 text-purple-800 dark:text-purple-200">
+                  {deepThinkingLevel.toUpperCase()}
+                </span>
+              )}
+            </button>
+            <select
+              value={deepThinkingLevel}
+              onChange={(e) => setDeepThinkingLevel(e.target.value as 'low'|'medium'|'high')}
+              className="text-xs px-2 py-1 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"
+              title="æ€è€ƒé‡"
+            >
+              <option value="low">Low</option>
+              <option value="medium">Medium</option>
+              <option value="high">High</option>
+            </select>
+          </div>
*** End Patch
PATCH

# 1.3 è¯·æ±‚ä½“ï¼šæŠŠå¼€å…³ä¸ç­‰çº§ä¸€èµ·ä¼ ç»™åç«¯ï¼ˆå…¼å®¹æ—§å­—æ®µï¼‰
# handleSend()
CODEMOD app/chat/page.tsx <<'PATCH'
*** Begin Patch
*** Update File: app/chat/page.tsx
@@
-        body: JSON.stringify({ 
-          messages: newMessages,
-          deepThinking: deepThinking,
-          browserSearch: browserSearch,
-          avatarEnabled: avatarEnabled,
-          avatarVoice: getSelectedVoice(), // ä»localStorageè¯»å–
-          modelProvider: selectedModel,
-          hasFiles: uploadedFiles.length > 0
-        }),
+        body: JSON.stringify({ 
+          messages: newMessages,
+          // å…¼å®¹æ—§å­—æ®µ
+          deepThinking: deepThinkingEnabled,
+          // æ–°å­—æ®µï¼šæ˜¾å¼æ§åˆ¶ GPT-5 Responses çš„ reasoning.effort
+          reasoning: deepThinkingEnabled ? { effort: deepThinkingLevel } : { effort: 'none' },
+          deepThinkingEnabled,
+          deepThinkingLevel,
+          browserSearch: browserSearch,
+          avatarEnabled: avatarEnabled,
+          avatarVoice: getSelectedVoice(), // ä»localStorageè¯»å–
+          modelProvider: selectedModel,
+          hasFiles: uploadedFiles.length > 0
+        }),
*** End Patch
PATCH

# 1.4 â€œæ¥è‡ªæ•°å­—å‘˜å·¥çš„ä»»åŠ¡â€åˆ†æ”¯ä¹Ÿè¦ä¼ ï¼ˆhandleSubmitFromAvatarï¼‰
CODEMOD app/chat/page.tsx <<'PATCH'
*** Begin Patch
*** Update File: app/chat/page.tsx
@@
-        body: JSON.stringify({ 
-          messages: newMessages,
-          deepThinking: deepThinking,
-          browserSearch: browserSearch,
-          avatarEnabled: avatarEnabled,
-          avatarVoice: getSelectedVoice(),
-          modelProvider: selectedModel,
-          hasFiles: false
-        }),
+        body: JSON.stringify({ 
+          messages: newMessages,
+          deepThinking: deepThinkingEnabled,
+          reasoning: deepThinkingEnabled ? { effort: deepThinkingLevel } : { effort: 'none' },
+          deepThinkingEnabled,
+          deepThinkingLevel,
+          browserSearch: browserSearch,
+          avatarEnabled: avatarEnabled,
+          avatarVoice: getSelectedVoice(),
+          modelProvider: selectedModel,
+          hasFiles: false
+        }),
*** End Patch
PATCH

# 1.5 UI ä¸­æ˜¾ç¤ºâ€œæ€è€ƒè¿‡ç¨‹å¡ç‰‡â€çš„æ¡ä»¶ä¸å˜ï¼ˆæœåŠ¡å™¨ä»å¯æµ pushï¼‰ï¼Œæ— éœ€æ”¹åŠ¨ã€‚
SAVE ALL


# ========== 2) æ•°å­—å‘˜å·¥ï¼šapp/chat/AvatarDisplay.tsx ==========
OPEN app/chat/AvatarDisplay.tsx

# 2.1 çŠ¶æ€ï¼šå¼€å…³ + ç­‰çº§ï¼ˆæœ¬ç»„ä»¶å·²æœ‰ deepThinking å¸ƒå°”ï¼Œæ‰©å±•ä¸ºå¸¦ç­‰çº§ï¼‰
CODEMOD app/chat/AvatarDisplay.tsx <<'PATCH'
*** Begin Patch
*** Update File: app/chat/AvatarDisplay.tsx
@@
-  const [deepThinking, setDeepThinking] = useState(false); // æ·±åº¦æ€è€ƒæ¨¡å¼
+  const [deepThinkingEnabled, setDeepThinkingEnabled] = useState<boolean>(() => {
+    if (typeof window === 'undefined') return false;
+    const saved = localStorage.getItem('avatar_deep_thinking_enabled');
+    return saved ? saved === 'true' : false;
+  });
+  const [deepThinkingLevel, setDeepThinkingLevel] = useState<'low'|'medium'|'high'>(() => {
+    if (typeof window === 'undefined') return 'low';
+    return (localStorage.getItem('avatar_deep_thinking_level') as any) || 'low';
+  });
+  useEffect(() => {
+    if (typeof window !== 'undefined') {
+      localStorage.setItem('avatar_deep_thinking_enabled', String(deepThinkingEnabled));
+      localStorage.setItem('avatar_deep_thinking_level', deepThinkingLevel);
+    }
+  }, [deepThinkingEnabled, deepThinkingLevel]);
*** End Patch
PATCH

# 2.2 å·¥å…·æ æŒ‰é’®ï¼šå¼€å…³ + ç­‰çº§ä¸‹æ‹‰
CODEMOD app/chat/AvatarDisplay.tsx <<'PATCH'
*** Begin Patch
*** Update File: app/chat/AvatarDisplay.tsx
@@
-              <button
-                onClick={() => setDeepThinking(!deepThinking)}
-                className={`btn-ghost text-sm ${deepThinking ? 'bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400' : ''}`}
-                title="æ·±åº¦æ€è€ƒæ¨¡å¼ï¼ˆä½¿ç”¨æ›´å¼ºå¤§çš„æ¨ç†èƒ½åŠ›ï¼‰"
-              >
-                <Brain size={16} className={deepThinking ? 'text-purple-600' : ''} />
-                æ·±åº¦æ€è€ƒ
-                {deepThinking && (
-                  <span className="ml-1 text-xs px-1.5 py-0.5 rounded bg-purple-200 dark:bg-purple-800 text-purple-800 dark:text-purple-200">
-                    ON
-                  </span>
-                )}
-              </button>
+              <div className="flex items-center gap-2">
+                <button
+                  onClick={() => setDeepThinkingEnabled(!deepThinkingEnabled)}
+                  className={`btn-ghost text-sm ${deepThinkingEnabled ? 'bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400' : ''}`}
+                  title="æ·±åº¦æ€è€ƒæ¨¡å¼ï¼ˆä½¿ç”¨æ›´å¼ºå¤§çš„æ¨ç†èƒ½åŠ›ï¼‰"
+                >
+                  <Brain size={16} className={deepThinkingEnabled ? 'text-purple-600' : ''} />
+                  æ·±åº¦æ€è€ƒ
+                  {deepThinkingEnabled && (
+                    <span className="ml-1 text-xs px-1.5 py-0.5 rounded bg-purple-200 dark:bg-purple-800 text-purple-800 dark:text-purple-200">
+                      {deepThinkingLevel.toUpperCase()}
+                    </span>
+                  )}
+                </button>
+                <select
+                  value={deepThinkingLevel}
+                  onChange={(e) => setDeepThinkingLevel(e.target.value as 'low'|'medium'|'high')}
+                  className="text-xs px-2 py-1 rounded border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"
+                  title="æ€è€ƒé‡"
+                >
+                  <option value="low">Low</option>
+                  <option value="medium">Medium</option>
+                  <option value="high">High</option>
+                </select>
+              </div>
*** End Patch
PATCH

# 2.3 å‘é€åˆ° voice_serverï¼šæŠŠå¼€å…³/ç­‰çº§ + reasoning ä¸€èµ·å¸¦ä¸Š
CODEMOD app/chat/AvatarDisplay.tsx <<'PATCH'
*** Begin Patch
*** Update File: app/chat/AvatarDisplay.tsx
@@
-      const response = await fetch(`${voiceServerUrl}/api/avatar-chat-stream`, {
+      const response = await fetch(`${voiceServerUrl}/api/avatar-chat-stream`, {
         method: 'POST',
         headers: { 'Content-Type': 'application/json' },
         body: JSON.stringify({
           message: userMessage,
           voice: selectedAvatar,
           history: currentHistory, // å‘é€å½“å‰å†å²ï¼ˆä¸åŒ…æ‹¬åˆšæ·»åŠ çš„ç”¨æˆ·æ¶ˆæ¯ï¼‰
           agent_working: isAgentWorking, // å‘é€Agentic AIå·¥ä½œçŠ¶æ€
-          deep_thinking: deepThinking, // æ·±åº¦æ€è€ƒæ¨¡å¼
+          deep_thinking_enabled: deepThinkingEnabled,
+          deep_thinking_level: deepThinkingLevel,
+          reasoning: deepThinkingEnabled ? { effort: deepThinkingLevel } : { effort: 'none' },
           uploaded_files: uploadedFilePaths // ä¸Šä¼ çš„æ–‡ä»¶è·¯å¾„
         })
       });
*** End Patch
PATCH

SAVE ALL
```

---

## ğŸ“Œ åç«¯å…¼å®¹è¯´æ˜

* ä½ åŸæ¥åœ¨ `/api/chat` é‡Œè¯»å–äº† `deepThinking` å¸ƒå°”ï¼›ç°åœ¨ä»ç„¶ä¼ è¿™ä¸ªï¼ˆåŒæ­¥ `deepThinkingEnabled`ï¼‰ï¼Œ**åŒæ—¶**æ–°ä¼  `reasoning`ï¼ˆæ ‡å‡†å­—æ®µï¼‰ã€‚
* GPT-5 Responses API ç‰ˆæœ¬ï¼ˆä½ åˆšä¿®è¿‡çš„ `gpt5_service.py`ï¼‰å·²ç»æ”¯æŒè¯»å– `reasoning: { effort: 'low'|'medium'|'high' }`ï¼›è¿™æ¬¡å‰ç«¯å°±èƒ½çœŸæ­£**æ§åˆ¶**æ¨ç†å¼ºåº¦ã€‚
* æ•°å­—å‘˜å·¥çš„ `voice_server` è¿™è¾¹ä¹Ÿæ”¶åˆ°äº† `reasoning`ï¼Œå¦‚æœåç«¯æ²¡æœ‰å¤„ç†ï¼Œä¼šè¢«å¿½ç•¥ä½†ä¸å½±å“è¯·æ±‚ï¼›è‹¥ä½ æƒ³è®©å®ƒä¹Ÿç”Ÿæ•ˆï¼Œç›´æ¥åœ¨æœåŠ¡ç«¯è¯»å– `reasoning.effort` è°ƒæ•´æ¨¡å‹å‚æ•°å³å¯ã€‚

---

## âœ… æœŸå¾…æ•ˆæœ

* å·¥å…·æ æŒ‰é’®å¯**å¼€/å…³**æ·±åº¦æ€è€ƒï¼›
* å³ä¾§ä¸‹æ‹‰å¯**åˆ‡æ¢æ€è€ƒé‡**ï¼›
* è¯·æ±‚ä½“ä¼šæºå¸¦ `reasoning.effort`ï¼ŒGPT-5 å°†æŒ‰è®¾å®šè¿›è¡Œå°‘/ä¸­/å¤šæ€è€ƒï¼›
* æ•°å­—å‘˜å·¥é“¾è·¯åŒæ ·ç”Ÿæ•ˆï¼Œç¡®ä¿â€œä¸»èŠå¤©â€å’Œâ€œå¤´åƒå¯¹è¯â€ä½“éªŒä¸€è‡´ã€‚

éœ€è¦çš„è¯ï¼Œæˆ‘å¯ä»¥å†è¡¥ä¸€ç‰ˆ `/api/chat/route.ts` å’Œ `voice_server` çš„**åç«¯è¯»å–æ¼”ç¤ºä»£ç **ï¼ŒæŠŠ `reasoning.effort` æ˜ å°„åˆ°å…·ä½“ providerï¼ˆOpenAI/Claude/æœ¬åœ°æ¨¡å‹ï¼‰çš„å‚æ•°ã€‚
