# 通用智能体协议 - 系统提示词升级完成

## ✅ 已完成

已为所有 Agentic AI 模型应用全新的通用智能体工作协议，大幅提升输出质量和可验证性。

## 核心改进

### 1. **结构化工作协议**

#### 规划阶段
- ✅ 先列出 3-7 步高层计划
- ✅ 明确关键假设
- ✅ 指明验收标准与交付物

#### 工具使用
- ✅ 明确调用目的、输入、结果
- ✅ 时效性信息必须先搜索验证
- ✅ 无法验证的标记为不确定

#### 推理约束
- ✅ 结构化推理
- ✅ 只输出结论与证据摘要
- ✅ 明确边界条件和失败模式
- ✅ 所有数字给出来源或计算过程

#### 质量校验
六项自查标准：
1. 完整性
2. 正确性
3. 一致性
4. 可执行性
5. 风险与依赖
6. 可复现性

### 2. **标准化输出格式**

每次任务完成后，AI 会按以下结构组织回复：

```
【快速结论】
一句话概括结果

【详细内容】
具体的执行结果、生成的内容、工具输出等

【执行记录】
- 使用的工具
- 关键决策
- 数据来源

【质量验证】
- 完整性：✓/✗
- 准确性：✓/✗
- 可执行性：✓/✗

【局限说明】
适用范围、边界条件、已知限制
```

### 3. **决策准则**

- **任何结论必须包含**：数据/来源 + 方法/公式 + 局限性
- **歧义处理**：列出可行解释 → 选择最可能的 → 说明取舍
- **诚实原则**：不编造来源、不编造数据、明确不确定性

## 应用范围

新系统提示词已应用于所有 Agentic AI 模型：

| 模型 | 状态 | Max Tokens |
|------|------|-----------|
| **Claude Sonnet 4** | ✅ 已应用 | 16000 / 8000 |
| **GPT-4o** | ✅ 已应用 | 16000 / 8000 |
| **GPT-4 Turbo** | ✅ 已应用 | 16000 / 8000 |
| **豆包** | ✅ 已应用 | 16000 / 8000 |
| **GPT-5** | ✅ 已应用 | 自动 |
| **Ollama** | ✅ 已应用 | 模型决定 |

## 预期效果

### 输出质量提升

#### 之前
```
用户：帮我分析 AI 的发展趋势

AI：AI技术在近年来发展迅速，包括深度学习、自然语言处理等领域...
（缺少来源、缺少数据、缺少验证）
```

#### 现在
```
用户：帮我分析 AI 的发展趋势

AI：
【快速结论】
AI技术呈现三大主流趋势：大模型规模化、多模态融合、行业应用深化

【详细内容】
1. 大模型规模化
   - GPT-4: 1.7万亿参数 (来源：OpenAI 2023年报告)
   - Claude 3.5: 多专家混合架构
   - 趋势：参数量持续增长但成本优化

2. 多模态融合
   - 文本+图像：GPT-4V、Claude 3.5 Sonnet
   - 文本+语音：实时对话模型
   - 数据：2024年多模态模型市场占有率达45%

【执行记录】
- 使用工具：search_web ("2025 AI 技术趋势")
- 数据来源：OpenAI官方文档、Gartner报告、科技媒体
- 更新时间：2025年10月

【质量验证】
- 完整性：✓ 覆盖三大趋势
- 准确性：✓ 数据可溯源
- 可执行性：✓ 可用于决策参考

【局限说明】
- 适用范围：通用AI技术趋势，不针对特定行业
- 时效性：基于2025年10月数据
- 已知限制：未来可能出现突破性技术变革
```

### 工具调用更规范

**之前**：随意调用，缺少说明
```
调用 search_web → 返回结果 → 直接使用
```

**现在**：每次调用都记录目的和结果
```
【工具调用】search_web
目的：获取2025年AI技术最新趋势
输入：{"query": "2025 AI technology trends"}
关键结果：找到5篇权威报告，提取核心数据
```

### 数据可追溯

**之前**：
```
"AI市场增长迅速"（无数据支撑）
```

**现在**：
```
"AI市场2024年规模达1847亿美元，同比增长37.3%（来源：IDC 2024 Q3报告）"
```

## 兼容性

### 保留的功能
- ✅ 工具调用（所有现有工具）
- ✅ 深度思考模式
- ✅ 浏览器搜索
- ✅ 数字员工协作
- ✅ 多模态输入（图片、文件）

### 新增要求
- ✅ 输出必须可验证
- ✅ 输出必须可执行
- ✅ 输出必须可复现
- ✅ 标准化的输出格式

## 使用示例

### 示例 1：数据分析任务

**用户**：分析我们公司第三季度的销售数据

**AI 输出**：
```
【快速结论】
第三季度销售额1250万，同比增长23%，主要增长来自新产品线

【详细内容】
1. 总体表现
   - 销售额：1250万元
   - 同比增长：23%
   - 环比增长：8%

2. 产品线分析
   - 新产品A：450万 (36%)
   - 传统产品B：580万 (46%)
   - 其他：220万 (18%)

【执行记录】
- 工具：read_file (读取销售数据文件)
- 工具：calculate (计算增长率)
- 数据来源：Q3_sales_data.xlsx

【质量验证】
- 完整性：✓ 覆盖总体、产品线、趋势
- 准确性：✓ 计算可复核
- 可执行性：✓ 提供决策建议

【局限说明】
- 仅基于销售额，未包含利润率分析
- 未考虑季节性因素
- 建议：结合成本数据做进一步分析
```

### 示例 2：技术方案设计

**用户**：帮我设计一个客户管理系统的数据库架构

**AI 输出**：
```
【快速结论】
采用关系型数据库（PostgreSQL），5张核心表，支持10万+客户规模

【详细内容】
数据库表设计：

1. customers (客户表)
   - id: UUID (主键)
   - name: VARCHAR(100)
   - email: VARCHAR(255) UNIQUE
   - created_at: TIMESTAMP

2. orders (订单表)
   - id: UUID (主键)
   - customer_id: UUID (外键)
   - amount: DECIMAL(10,2)
   - status: ENUM('pending','paid','cancelled')

[... 详细设计 ...]

【执行记录】
- 推理过程：分析业务需求 → 确定实体关系 → 设计表结构
- 参考标准：数据库三范式、索引最佳实践
- 验证方式：绘制ER图、检查完整性约束

【质量验证】
- 完整性：✓ 覆盖所有业务实体
- 准确性：✓ 符合数据库设计规范
- 可执行性：✓ 提供完整SQL建表语句

【局限说明】
- 适用范围：中小规模（<10万客户）
- 扩展性：需要时可改为分库分表
- 已知限制：未考虑数据归档策略
```

## 技术细节

### 实现位置
- **文件**: `app/api/chat/route.ts`
- **变量**: `systemPrompt`
- **行数**: 第 131-195 行

### 动态元素
- 当前时间：自动更新
- 用户任务：从最后一条消息提取（暂未使用，保留扩展性）

### 所有模型统一
无论用户选择哪个 AI 模型（Claude、GPT-4o、豆包、Ollama），都会使用相同的工作协议，确保：
- 一致的输出质量
- 统一的格式标准
- 相同的验证要求

## 服务状态

- ✅ 前端已重启 (端口 3000)
- ✅ 后端运行正常 (端口 8001)
- ✅ 新系统提示词已生效

## 测试建议

### 测试 1：复杂任务
```
"帮我创建一份详细的 AI 技术发展报告，包含技术框架、应用案例、未来趋势，要求有数据支撑"
```

**预期**：
- 输出包含完整的【快速结论】【详细内容】等结构
- 数据有来源标注
- 包含质量验证和局限说明

### 测试 2：时效性问题
```
"最新的 AI 技术突破是什么？"
```

**预期**：
- 自动调用 search_web 搜索最新信息
- 在【执行记录】中说明搜索过程
- 数据标注时间和来源

### 测试 3：计算任务
```
"计算复利：本金10万，年利率5%，投资10年的收益"
```

**预期**：
- 调用 calculate 工具
- 给出计算公式
- 说明计算过程可复现

## 与数字员工的配合

### 工作流程
1. 数字员工接收用户任务
2. 生成详细的 Markdown 提示词 `{任务描述}`
3. 提示词发送给 Agentic AI
4. Agentic AI 按照通用智能体协议执行
5. 输出结构化、可验证的结果
6. 数字员工总结并播报

### 协议一致性
- 数字员工提示词要求 Markdown 格式 ✓
- Agentic AI 输出 Markdown 结构 ✓
- 双方都强调可验证性 ✓

---

所有修改已完成并生效！现在 Mindflow 智能体将以更专业、更严谨、更可靠的方式完成任务。🎉

