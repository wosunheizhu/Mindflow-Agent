# 链接区分显示 - 功能说明

## 功能概述

AI 回答中的链接现在会自动识别并区分两种类型：
1. **可下载文件链接** - 突出显示，带下载按钮
2. **普通网页链接** - 常规显示，用于参考

---

## 视觉区别

### 1. 可下载文件链接（蓝色突出）

**文本中的样式**：
- 粗体字体
- 蓝色背景高亮
- 加粗下划线
- 标注"点击下载文件"

**卡片样式**：
- 蓝色渐变背景
- 蓝色边框（2px）
- 文件图标（根据文件类型）
- 文件扩展名标签
- 下载按钮图标
- 标注"可下载文件"

### 2. 普通网页链接（灰色常规）

**文本中的样式**：
- 常规字体
- 蓝色文字
- 虚线下划线
- 在新标签打开

**卡片样式**：
- 白色/灰色背景
- 灰色边框
- 网站图标
- 标注"参考链接"

---

## 自动识别规则

系统会自动识别以下链接为**下载链接**：

1. 包含 `/api/download/` 路径
2. 包含 `/download/` 路径
3. 以文件扩展名结尾：
   - 文档：`.pdf`, `.doc`, `.docx`, `.txt`, `.md`
   - 表格：`.xls`, `.xlsx`, `.csv`
   - 演示：`.ppt`, `.pptx`
   - 压缩：`.zip`, `.rar`

**示例**：
```
下载链接：
- /api/download/report.pdf
- https://example.com/files/data.xlsx
- /download/presentation.pptx

普通链接：
- https://github.com
- https://docs.example.com
- https://news.site.com/article
```

---

## UI 展示效果

### 当 AI 回答包含两种链接时：

```
AI 回答：
我已经生成了报告，请查看：/api/download/report.pdf
参考资料来源：https://example.com/source

显示效果：
┌─────────────────────────────────────┐
│ 可下载文件 (1)                      │
├─────────────────────────────────────┤
│ [📄] PDF | 可下载文件               │
│     report.pdf              [⬇️]    │
│     (蓝色渐变背景，突出显示)        │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ 参考链接 (1)                        │
├─────────────────────────────────────┤
│ [🌐] example.com                    │
│     https://example.com/source      │
│     (灰色背景，常规显示)            │
└─────────────────────────────────────┘
```

---

## 功能特点

### 下载链接卡片

1. **视觉突出**
   - 蓝色渐变背景（from-blue-50 to-cyan-50）
   - 2px 蓝色边框
   - 悬停时阴影效果

2. **文件图标**
   - PDF/Word：文档图标
   - Excel：表格图标
   - PPT：演示图标
   - 其他：通用文件图标

3. **文件信息**
   - 文件扩展名标签
   - "可下载文件"标识
   - 文件名显示（自动截断）

4. **下载按钮**
   - 圆形蓝色按钮
   - 下载图标
   - 悬停时放大效果

5. **优先显示**
   - 始终显示在参考链接之前
   - 更大的卡片尺寸

### 普通链接卡片

1. **常规样式**
   - 灰白色背景
   - 细边框
   - 简洁设计

2. **网站信息**
   - 网站 favicon
   - 域名显示
   - 完整 URL

3. **分类标识**
   - "参考链接"标签
   - 链接数量统计

---

## 使用场景

### 场景1：生成报告
```
用户："生成一份AI技术报告"
AI：生成报告完成，下载链接：/api/download/ai-report.md

显示：
- 蓝色高亮卡片
- 文档图标 + MD标签
- 下载按钮
```

### 场景2：搜索资料
```
用户："搜索AI技术趋势"
AI：找到以下参考资料：
    https://hai.stanford.edu/ai-index
    https://www.pwc.com/ai-predictions

显示：
- 灰色常规卡片
- 网站图标
- "参考链接"标识
```

### 场景3：混合内容
```
用户："搜索并生成报告"
AI：已搜索资料并生成报告：
    报告文件：/api/download/report.pdf
    参考来源：https://source1.com
              https://source2.com

显示：
- 可下载文件区域（蓝色，1个）
- 参考链接区域（灰色，2个）
```

---

## 技术实现

### 新增组件

1. **DownloadLinkCard.tsx**
   - 专门用于下载链接
   - 蓝色突出样式
   - 文件图标识别
   - 下载按钮

### 修改组件

2. **Linkify.tsx**
   - 添加链接类型识别
   - 分离下载链接和普通链接
   - 分区域显示
   - 添加标签和计数

### 链接识别逻辑

```typescript
const isDownloadLink = (url: string): boolean => {
  return url.includes('/api/download/') || 
         url.includes('/download/') || 
         /\.(pdf|docx?|xlsx?|pptx?|zip|rar|md|txt)(\?|$)/i.test(url);
};
```

---

## 样式细节

### 下载链接（文本中）
```css
- 字体：font-semibold（粗体）
- 颜色：text-blue-700（深蓝）
- 背景：bg-blue-50（浅蓝）
- 下划线：decoration-2（2px粗）
- 悬停：decoration-4（4px更粗）
```

### 下载链接（卡片）
```css
- 边框：border-2 border-blue-500（蓝色2px）
- 背景：from-blue-50 to-cyan-50（渐变）
- 图标：蓝色圆角方块，白色图标
- 按钮：蓝色圆形，悬停放大
```

### 普通链接（文本中）
```css
- 颜色：text-blue-600（蓝色）
- 下划线：decoration-dotted（虚线）
- 悬停：decoration-solid（实线）
```

### 普通链接（卡片）
```css
- 边框：border border-gray-200（灰色细边框）
- 背景：bg-white（白色）
- 图标：网站 favicon
- 样式：简洁低调
```

---

## 响应式设计

### 下载链接卡片
- 最小宽度：300px
- 自动填充布局
- 移动端单列显示

### 普通链接卡片
- 最小宽度：260px
- 自动填充布局
- 移动端单列显示

---

## 无障碍特性

1. **语义化标签**
   - 下载链接添加 `download` 属性
   - 明确的 `title` 提示

2. **视觉提示**
   - 颜色对比度高
   - 多重视觉标识（颜色+图标+文字）

3. **交互反馈**
   - 悬停效果
   - 按钮缩放动画
   - 阴影变化

---

## 测试验证

### 测试用例1：纯下载链接
```
输入：/api/download/report.pdf
期望：蓝色卡片，文档图标，下载按钮
```

### 测试用例2：纯网页链接
```
输入：https://github.com
期望：灰色卡片，GitHub图标，外部链接
```

### 测试用例3：混合链接
```
输入：
下载：/api/download/data.xlsx
参考：https://example.com

期望：
- 两个区域分开
- 下载区域在上（蓝色）
- 参考区域在下（灰色）
```

---

## 相关文件

- `components/DownloadLinkCard.tsx` - 下载链接卡片组件（新增）
- `components/Linkify.tsx` - 链接处理组件（已修改）
- `components/LinkCardSimple.tsx` - 普通链接卡片（已有）
- `app/chat/page.tsx` - 聊天页面（已集成）

---

## 效果预览

**修改前**：
- 所有链接样式一致
- 无法快速识别下载链接
- 下载体验不明显

**修改后**：
- 下载链接突出显示
- 一眼就能看出可下载文件
- 点击即可下载，用户体验提升

---

## 后续优化建议

1. 添加文件大小显示
2. 添加下载进度提示
3. 支持批量下载
4. 添加文件预览功能
5. 支持拖拽下载

---

**功能已完成，刷新页面即可看到效果！** 🎉

