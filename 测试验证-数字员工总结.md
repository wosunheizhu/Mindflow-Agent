# 数字员工总结功能 - 测试验证

## 🧪 测试步骤

### 1. 打开浏览器并清除缓存
```
1. 打开 Chrome/Edge 浏览器
2. 按 Cmd+Shift+R（Mac）或 Ctrl+Shift+R（Windows）强制刷新
3. 访问 http://localhost:3000
4. 按 F12 打开开发者工具，切换到 Console 标签
```

### 2. 打开数字员工对话框
```
1. 点击右下角或左侧的数字员工头像
2. 等待对话框展开
```

### 3. 发送测试任务
```
输入：搜索一下人工智能最新发展
```

### 4. 观察日志和结果

#### 前端控制台应该看到（按F12）：

**正确的日志序列**：
```
📨 收到数字员工任务: 小岚 - 搜索一下人工智能最新发展
🎤 [数字员工任务] 数字员工开始总结...
🎤 [数字员工任务] 数字员工总结完成 [...]
📤 [数字员工任务] 发送 avatar_summary 事件到数字员工组件   ← 应该只出现一次！
✅ [数字员工组件] 处理 avatar_summary 事件                  ← 应该只出现一次！
💬 [数字员工组件] 更新历史，当前总数: X
```

**错误的日志序列**（如果问题仍存在）：
```
📤 [数字员工任务] 发送 avatar_summary 事件到数字员工组件   ← 出现多次
📤 [数字员工任务] 发送 avatar_summary 事件到数字员工组件   ← 重复
```

#### 后端日志应该看到：

```bash
# 查看 Next.js 后端
tail -f /Users/juntinghua/Desktop/agent/next_dev.log | grep -E "开始第.*轮|LLM-TTS"
```

**正确的日志**：
```
🔄 开始第 1 轮对话   ← 每轮只出现一次
🔄 开始第 2 轮对话   ← 每轮只出现一次
🎤 LLM-TTS双向流式完成   ← 只出现一次
```

**错误的日志**（如果问题仍存在）：
```
🔄 开始第 1 轮对话
🔄 开始第 1 轮对话   ← 重复！
🎤 LLM-TTS双向流式完成
🎤 LLM-TTS双向流式完成   ← 重复！
```

---

## 🔍 如果问题仍然存在

### 检查1：确认代码已生效
```bash
cd /Users/juntinghua/Desktop/agent
grep -n "_avatarLastSummary" app/chat/page.tsx | head -5
```

应该看到多处出现 `_avatarLastSummary`

### 检查2：查看前端控制台完整日志
请复制整个控制台日志，特别关注：
- 有几次 `📨 收到数字员工任务`
- 有几次 `📤 发送 avatar_summary 事件`
- 有几次 `✅ [数字员工组件] 处理 avatar_summary 事件`

### 检查3：查看后端日志
```bash
tail -100 /Users/juntinghua/Desktop/agent/next_dev.log | grep -E "🔄 开始第|🎤 LLM-TTS"
```

---

## 📝 请告诉我

如果问题仍然存在，请提供：

1. **前端控制台日志**（从发送消息到收到总结的完整日志）
2. **看到了几次总结**（例如："看到2次相同的总结" 或 "看到2次不同的总结"）
3. **总结的具体内容**（两次总结分别说了什么）

这样我可以精确定位问题所在。

