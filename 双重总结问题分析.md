# æ•°å­—å‘˜å·¥åŒé‡æ€»ç»“é—®é¢˜åˆ†æä¸ä¿®å¤

## é—®é¢˜æè¿°

æ•°å­—å‘˜å·¥ä¼šæ€»ç»“ä¸¤æ¬¡ Agent çš„ç”Ÿæˆç»“æœï¼š

```
å°å²šï¼šé©¬ä¸Šå¤„ç†
å°å²šï¼šAgentic AIåˆšæ‰å°è¯•æœç´¢2024-2025 Agentç³»ç»Ÿæœ€æ–°å‘å±•ï¼Œä¸è¿‡æœç´¢æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œé‡è¯•3æ¬¡éƒ½å¤±è´¥äº†ã€‚
å°å²šï¼šè€æ¿ï¼ŒAgentic AIå°è¯•æœç´¢"2024-2025 AI agent systems advancements"ï¼Œä½†æœç´¢æœåŠ¡å¤±è´¥äº†ï¼Œè¿˜æ˜¾ç¤ºå·²é‡è¯•3æ¬¡å‘¢ã€‚
```

## æ ¹æœ¬åŸå› 

åœ¨ `app/chat/page.tsx` ä¸­æœ‰ä¸¤å¤„ä»£ç éƒ½åœ¨å¤„ç† `avatar_audio` äº‹ä»¶å¹¶å‘é€ `avatar_summary`ï¼š

### ç¬¬ä¸€å¤„ï¼ˆ379-411è¡Œï¼‰- handleSubmitFromAvatar å‡½æ•°
```typescript
} else if (parsed.type === 'avatar_audio') {
  // æ•°å­—å‘˜å·¥æ€»ç»“å®Œæˆ
  console.log(`ğŸ¤ [æ•°å­—å‘˜å·¥ä»»åŠ¡] æ•°å­—å‘˜å·¥æ€»ç»“å®Œæˆ...`);
  
  // é€šçŸ¥æ•°å­—å‘˜å·¥ç»„ä»¶æ˜¾ç¤ºæ€»ç»“æ¶ˆæ¯
  if (parsed.summaryText && parsed.summaryText.trim()) {
    window.dispatchEvent(new CustomEvent('agent_avatar_message', {
      detail: {
        type: 'avatar_summary', 
        text: parsed.summaryText.trim(),
        voice: currentVoice
      }
    }));
  }
}
```

### ç¬¬äºŒå¤„ï¼ˆ626-648è¡Œï¼‰- handleSend å‡½æ•°
```typescript
} else if (parsed.type === 'avatar_audio') {
  // LLM-TTSåŒå‘æµå¼å®Œæˆï¼ˆç¬¬äºŒæ¬¡å›ç­”ï¼‰ï¼Œé™é»˜æ’­æ”¾éŸ³é¢‘
  console.log(`ğŸ¤ æ•°å­—å‘˜å·¥æ€»ç»“å®Œæˆ...`);
  
  // é€šçŸ¥æ•°å­—å‘˜å·¥ç»„ä»¶æ˜¾ç¤ºæ€»ç»“æ¶ˆæ¯
  if (parsed.summaryText && parsed.summaryText.trim()) {
    window.dispatchEvent(new CustomEvent('agent_avatar_message', {
      detail: {
        type: 'avatar_summary', 
        text: parsed.summaryText.trim(),
        voice: currentVoice
      }
    }));
  }
}
```

## é—®é¢˜åˆ†æ

å½“æ•°å­—å‘˜å·¥è§¦å‘ä»»åŠ¡æ—¶ï¼š
1. ç”¨æˆ·é€šè¿‡æ•°å­—å‘˜å·¥å¯¹è¯æ¡†å‘é€æ¶ˆæ¯
2. æ•°å­—å‘˜å·¥ç”Ÿæˆå¸¦ `{æç¤ºè¯}` çš„å›å¤
3. å‰ç«¯æ£€æµ‹åˆ°æç¤ºè¯ï¼Œè§¦å‘ `avatar_agent_task` äº‹ä»¶
4. **äº‹ä»¶è¢«ä¸¤ä¸ªåœ°æ–¹åŒæ—¶ç›‘å¬**ï¼š
   - handleSubmitFromAvatarï¼ˆé€šè¿‡äº‹ä»¶ç›‘å¬å™¨ï¼‰
   - handleSendï¼ˆå¯èƒ½ä¹Ÿè¢«è§¦å‘ï¼Ÿï¼‰

ç»“æœï¼šåŒä¸€ä¸ª `avatar_audio` äº‹ä»¶è¢«å¤„ç†äº†ä¸¤æ¬¡ï¼Œå¯¼è‡´å‘é€äº†ä¸¤æ¬¡ `avatar_summary`ã€‚

## æœç´¢æœåŠ¡é—®é¢˜

ä»é”™è¯¯ä¿¡æ¯ "æœç´¢æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œé‡è¯•3æ¬¡éƒ½å¤±è´¥äº†" å¯ä»¥çœ‹å‡ºï¼š

1. **Brave Search API é…ç½®é—®é¢˜**
   - å¯èƒ½æ²¡æœ‰é…ç½® `BRAVE_API_KEY`
   - æˆ–è€… API Key æ— æ•ˆ/è¶…é¢
   - æˆ–è€…ç½‘ç»œè¿æ¥é—®é¢˜

2. **å½“å‰ä½¿ç”¨çš„å·¥å…·æ–‡ä»¶**: `lib/tools-complete.ts`
   - å·²ç»æœ‰é‡è¯•æœºåˆ¶ï¼ˆ3æ¬¡ï¼‰
   - è¶…æ—¶è®¾ç½®ï¼š15ç§’

## ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤ 1: è§£å†³åŒé‡æ€»ç»“é—®é¢˜

**æ–¹æ¡ˆAï¼ˆæ¨èï¼‰**ï¼šæ£€æŸ¥äº‹ä»¶æ¥æºï¼Œé¿å…é‡å¤å¤„ç†
```typescript
// åœ¨å…¶ä¸­ä¸€ä¸ªå¤„ç†å‡½æ•°ä¸­æ·»åŠ æ ‡è®°
let avatarAudioProcessed = false;

if (parsed.type === 'avatar_audio' && !avatarAudioProcessed) {
  avatarAudioProcessed = true;
  // å¤„ç†é€»è¾‘...
}
```

**æ–¹æ¡ˆB**ï¼šåˆ é™¤é‡å¤çš„äº‹ä»¶å¤„ç†ä»£ç 
- åªä¿ç•™ä¸€ä¸ªåœ°æ–¹å¤„ç† `avatar_audio`
- å»ºè®®ä¿ç•™ `handleSubmitFromAvatar` ä¸­çš„å¤„ç†ï¼Œåˆ é™¤ `handleSend` ä¸­çš„

### ä¿®å¤ 2: è§£å†³æœç´¢æœåŠ¡é—®é¢˜

**æ­¥éª¤1**ï¼šæ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
```bash
# æ£€æŸ¥ .env.local æ–‡ä»¶
cat .env.local | grep BRAVE_API_KEY
```

**æ­¥éª¤2**ï¼šå¦‚æœæ²¡æœ‰é…ç½®ï¼Œéœ€è¦è·å– API Key
- è®¿é—® https://brave.com/search/api/
- æ³¨å†Œå¹¶è·å– API Key
- æ·»åŠ åˆ° `.env.local`:
  ```
  BRAVE_API_KEY=your_api_key_here
  ```

**æ­¥éª¤3**ï¼šå¦‚æœå·²é…ç½®ä½†ä»å¤±è´¥ï¼Œæ£€æŸ¥ï¼š
- API Key æ˜¯å¦æœ‰æ•ˆ
- æ˜¯å¦è¶…è¿‡é…é¢é™åˆ¶
- ç½‘ç»œæ˜¯å¦å¯è®¿é—® https://api.search.brave.com

**æ­¥éª¤4ï¼ˆå¤‡é€‰ï¼‰**ï¼šä½¿ç”¨å…¶ä»–æœç´¢API
- DuckDuckGoï¼ˆå…è´¹ï¼Œæ— éœ€API Keyï¼‰
- Google Custom Searchï¼ˆéœ€è¦é…ç½®ï¼‰

## å»ºè®®çš„ä»£ç ä¿®æ”¹

åˆ é™¤ `handleSend` å‡½æ•°ä¸­çš„é‡å¤ä»£ç ï¼ˆ626-648è¡Œï¼‰ï¼š

```typescript
// åˆ é™¤è¿™æ®µä»£ç 
} else if (parsed.type === 'avatar_audio') {
  // è¿™æ®µä»£ç æ˜¯é‡å¤çš„ï¼Œä¼šå¯¼è‡´åŒé‡æ€»ç»“
  // ...
}
```

æˆ–è€…æ·»åŠ å»é‡é€»è¾‘ï¼š

```typescript
// åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ 
let lastProcessedAudioTimestamp = 0;

// åœ¨å¤„ç† avatar_audio æ—¶
} else if (parsed.type === 'avatar_audio') {
  const now = Date.now();
  if (now - lastProcessedAudioTimestamp < 1000) {
    console.log('â­ï¸ è·³è¿‡é‡å¤çš„ avatar_audio äº‹ä»¶');
    return;
  }
  lastProcessedAudioTimestamp = now;
  
  // æ­£å¸¸å¤„ç†é€»è¾‘...
}
```

## éªŒè¯æ­¥éª¤

ä¿®å¤åï¼Œæµ‹è¯•æµç¨‹ï¼š
1. å¯¹æ•°å­—å‘˜å·¥è¯´ï¼š"å¸®æˆ‘æœç´¢AIæŠ€æœ¯"
2. æ•°å­—å‘˜å·¥åº”è¯¥åªæ˜¾ç¤ºä¸€æ¬¡æ€»ç»“ï¼ˆä¸æ˜¯ä¸¤æ¬¡ï¼‰
3. å¦‚æœæœç´¢æˆåŠŸï¼Œåº”è¯¥è¿”å›æœç´¢ç»“æœ
4. å¦‚æœæœç´¢å¤±è´¥ï¼Œåº”è¯¥æ¸…æ¥šè¯´æ˜åŸå› 

## ä¼˜å…ˆçº§

1. **é«˜ä¼˜å…ˆçº§**ï¼šä¿®å¤åŒé‡æ€»ç»“é—®é¢˜
2. **ä¸­ä¼˜å…ˆçº§**ï¼šé…ç½® Brave Search API
3. **ä½ä¼˜å…ˆçº§**ï¼šä¼˜åŒ–é”™è¯¯æç¤º


